<!DOCTYPE html>
<html>
  <head>
    <title>Lightbox JSON API</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <style type='text/css'>
    .output {
      float: left;
      margin: 0 20px;
    }
    .output .mixed {
      width: 140px;
      height: 140px;
      border: 1px solid #000;
    }
    .output .layer {
      margin: 10px 20px;
      width: 40px;
      height: 40px;
      border: 1px solid #000;
    }
    </style>
  </head>
  <body>
    <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script>
      $(document).ready(function() {
        function updateBackground(output, box) {
          $.getJSON('/api/output?id=' + output, function(json) {
            box.css('background-color', json.mixedColorHex);
          });
        }

        $.getJSON('/api', function(json) {
          // Get the number of lights and add divs for it
          var preview = $('#preview');
          for (i = 0; i < json.outputs; i++) {
            // node.append($());
            var j = i;
            $.getJSON('/api/output?id=' + j, function(output) {
                var node = $('<div class="output"><strong>' + output.outputNumber + '</strong></div>');
                var box = $('<div class="mixed"></div>');
                box.css('background-color', output.mixedColorHex);
                node.append(box);
                setInterval(function (){updateBackground(output.outputNumber, box)}, 50);
                preview.append(node);
            });
          }
          console.log(json.outputs);
        });
      });
    </script>
    <h1>Lightbox JSON API</h1>
    <p>Lightbox was originally developed for the <a href="http://twitterboom.nl">Twitterboom</a>, which was demonstrated to the public during the Christmas season of 2011 in the public library of Leeuwarden, the hometown of <a href="http://frack.nl/wiki/">Frack</a>.</p>
    <p>All code and documentation is <a href="https://github.com/frack/Lightbox">available on GitHub</a>.</p>
    <h2>Send API commands</h2>
    <p>API commands can be one object that describes a transition for a single output+layer, or an array of these.</p>
    <p>Multiple transitions for a single output will be executed in series, multiple transitions for different outputs will be excecuted in unison.</p>
    <form method="post">
      <textarea name="json" cols="80" rows="20">%s</textarea>
      <br>
      <input type="submit" value="push!" />
    </form>
    <h2>API Information</h2>
    <ul>
      <li>API commands should be sent to <code>/api</code> (HTTP POST, argument <code>json</code>);</li>
      <li>Controller information can be retrieved from <a href="/api"><code>/api</code></a>;</li>
      <li>Output information (mixed and layer colors, opacity etc) can be retrieved from <a href="/api/output?id=0"><code>/api/output?id=OUTPUT_ID</code></a>.</li>
    </ul>
    <h2>Current strip colors</h2>
    <p>Basic jQuery/JavaScript retrieval for the current colors on the strip.</p>
    <div id="preview">
    </div>
  </body>
</html>
